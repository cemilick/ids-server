<!DOCTYPE html>
<html>

<head>
    <title>Real-time Intrusion Detection Dashboard</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <h1>Real-time Intrusion Detection Dashboard</h1>
    <button onclick="clearData()">Clear Data</button>
    <h2>Detected Intrusions</h2>
    <table id="intrusionTable" border="1">
        <thead>
            <tr>
                <th>IP Address</th>
                <th>Prediction</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        function makePrediction(data) {
            $.ajax({
                url: '/',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (response) {
                    $("#prediction").text(response.prediction);
                },
                error: function (error) {
                    $("#prediction").text("An error occurred.");
                }
            });
        }

        function makePrediction(data) {
            $.ajax({
                url: '/predict',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (response) {
                    $("#prediction").text(response.prediction);
                },
                error: function (error) {
                    $("#prediction").text("An error occurred.");
                }
            });
        }

        function updateIntrusionTable() {
            $.ajax({
                url: '/getIntrusions',
                type: 'GET',
                success: function (response) {
                    $('#intrusionTable tbody').empty();
                    response.intrusions.forEach(function (intrusion) {
                        $('#intrusionTable tbody').append('<tr><td>' + intrusion.ip_address + '</td><td>' + intrusion.prediction + '</td><td>' + intrusion.timestamp + '</td></tr>');
                    });
                },
                error: function (error) {
                    console.log("An error occurred while fetching intrusion data.");
                }
            });
        }

        function clearData() {
            $.ajax({
                url: '/clear',
                type: 'GET',
                success: function (response) {
                    alert('Successfully Clear Data')
                },
                error: function (error) {
                    alert('Clear Data Failed!')
                }
            });
        }

        setInterval(updateIntrusionTable, 5000);
    </script>
</body>

</html>